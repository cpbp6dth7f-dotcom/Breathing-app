<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Breathe">
<meta name="theme-color" content="#667eea">
<title>Breathing Guide</title>

<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
min-height: -webkit-fill-available;
display: flex;
justify-content: center;
align-items: center;
padding: 20px;
padding-top: max(20px, env(safe-area-inset-top));
padding-bottom: max(20px, env(safe-area-inset-bottom));
padding-left: max(20px, env(safe-area-inset-left));
padding-right: max(20px, env(safe-area-inset-right));
-webkit-user-select: none;
user-select: none;
-webkit-tap-highlight-color: transparent;
}

html {
height: -webkit-fill-available;
}

.container {
background: rgba(255, 255, 255, 0.95);
border-radius: 24px;
padding: 40px;
max-width: 500px;
width: 100%;
box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

h1 {
text-align: center;
color: #333;
margin-bottom: 30px;
font-size: 28px;
}

.breathing-circle-container {
display: flex;
justify-content: center;
align-items: center;
margin: 40px 0;
height: 320px;
position: relative;
}

.breathing-circle {
width: 120px;
height: 120px;
border-radius: 50%;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
display: flex;
justify-content: center;
align-items: center;
box-shadow: 0 10px 40px rgba(102, 126, 234, 0.5);
position: relative;
transition: width 0.3s ease, height 0.3s ease;
}

.breathing-circle::before {
content: '';
position: absolute;
width: 100%;
height: 100%;
border-radius: 50%;
background: inherit;
opacity: 0.3;
animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
0%, 100% { transform: scale(1); opacity: 0.3; }
50% { transform: scale(1.1); opacity: 0.1; }
}

.breathing-text {
text-align: center;
font-size: 28px;
font-weight: 600;
color: #333;
margin-bottom: 20px;
min-height: 36px;
}

.phase-timer {
text-align: center;
font-size: 48px;
font-weight: 700;
color: #667eea;
margin-bottom: 30px;
min-height: 58px;
}

.controls {
display: flex;
justify-content: center;
gap: 15px;
margin-bottom: 30px;
flex-wrap: wrap;
}

button {
padding: 12px 28px;
font-size: 16px;
font-weight: 600;
border: none;
border-radius: 12px;
cursor: pointer;
transition: all 0.3s ease;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

button:disabled {
opacity: 0.5;
cursor: not-allowed;
}

button:active {
transform: scale(0.98);
}

.start-btn {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
}

.pause-btn {
background: #ed8936;
color: white;
}

.stop-btn {
background: #f56565;
color: white;
}

.preset-actions {
display: flex;
gap: 10px;
margin-top: 15px;
}

.preset-actions input {
flex: 1;
padding: 10px;
border: 2px solid #e2e8f0;
border-radius: 8px;
font-size: 14px;
}

.preset-actions button {
padding: 10px 20px;
font-size: 14px;
}

.saved-presets {
margin-top: 15px;
}

.preset-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 10px;
background: white;
border-radius: 8px;
margin-bottom: 8px;
}

.preset-item:last-child {
margin-bottom: 0;
}

.preset-name {
font-weight: 600;
color: #333;
}

.preset-details {
font-size: 12px;
color: #666;
margin-top: 2px;
}

.preset-buttons {
display: flex;
gap: 8px;
}

.preset-buttons button {
padding: 6px 12px;
font-size: 12px;
}

.load-btn {
background: #48bb78;
color: white;
}

.delete-btn {
background: #f56565;
color: white;
}

.settings {
background: #f7fafc;
border-radius: 12px;
padding: 20px;
margin-top: 20px;
}

.settings h3 {
color: #333;
margin-bottom: 15px;
font-size: 18px;
}

.setting-group {
margin-bottom: 20px;
}

.setting-group:last-child {
margin-bottom: 0;
}

label {
display: block;
color: #555;
font-weight: 500;
margin-bottom: 8px;
font-size: 14px;
cursor: pointer;
-webkit-user-select: none;
user-select: none;
}

select, input[type="number"], input[type="text"] {
width: 100%;
padding: 10px;
border: 2px solid #e2e8f0;
border-radius: 8px;
font-size: 14px;
transition: border-color 0.3s ease;
background: white;
-webkit-user-select: text;
user-select: text;
-webkit-tap-highlight-color: rgba(102, 126, 234, 0.3);
touch-action: manipulation;
-webkit-appearance: none;
appearance: none;
}

input[type="number"] {
-moz-appearance: textfield;
}

input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
-webkit-appearance: none;
margin: 0;
opacity: 1;
}

select:focus, input[type="number"]:focus, input[type="text"]:focus {
outline: none;
border-color: #667eea;
}

.custom-timing {
display: none;
margin-top: 15px;
padding: 15px;
background: white;
border-radius: 8px;
position: relative;
z-index: 1;
}

.custom-timing.active {
display: block;
}

.timing-row {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 10px;
margin-bottom: 10px;
}

.timing-row > div {
position: relative;
}

.timing-row:last-child {
margin-bottom: 0;
}

.progress-container {
margin-top: 20px;
}

.progress-label {
display: flex;
justify-content: space-between;
margin-bottom: 5px;
font-size: 14px;
color: #555;
}

.progress-bar {
width: 100%;
height: 8px;
background: #e2e8f0;
border-radius: 4px;
overflow: hidden;
}

.progress-fill {
height: 100%;
background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
width: 0%;
transition: width 0.1s linear;
}

.install-banner {
background: #4299e1;
color: white;
padding: 15px;
border-radius: 12px;
margin-bottom: 20px;
text-align: center;
}

.install-banner button {
background: white;
color: #4299e1;
margin-top: 10px;
}

@media (max-width: 480px) {
.container {
padding: 30px 20px;
}

h1 {
font-size: 24px;
}

.breathing-text {
font-size: 24px;
}

.phase-timer {
font-size: 40px;
}
}
</style>
</head>
<body>
<div class="container">
<div id="installBanner" class="install-banner" style="display: none;">
<div>üì± Install this app to your home screen for offline use!</div>
<button onclick="showInstallInstructions()">Show Instructions</button>
</div>

<h1>ü´Å Breathing Guide</h1>

<div class="breathing-text" id="breathingText">Ready to begin</div>
<div class="phase-timer" id="phaseTimer"></div>

<div class="breathing-circle-container">
<div class="breathing-circle" id="breathingCircle"></div>
</div>

<div class="controls">
<button class="start-btn" id="startBtn">Start</button>
<button class="pause-btn" id="pauseBtn" style="display: none;">Pause</button>
<button class="stop-btn" id="stopBtn" style="display: none;">Stop</button>
</div>

<div class="progress-container" id="progressContainer" style="display: none;">
<div class="progress-label">
<span>Session Progress</span>
<span id="timeRemaining">5:00</span>
</div>
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
</div>

<div class="settings">
<h3>‚öôÔ∏è Settings</h3>

<div class="setting-group">
<label for="patternSelect">Breathing Pattern</label>
<select id="patternSelect">
<option value="relaxation">Relaxation (4-7-8)</option>
<option value="box">Box Breathing (4-4-4-4)</option>
<option value="calm">Calm (4-2-6-2)</option>
<option value="energize">Energize (4-0-4-0)</option>
<option value="custom">Custom Pattern</option>
</select>
</div>

<div class="custom-timing" id="customTiming">
<div class="timing-row">
<div>
<label for="inhaleTime">Inhale (sec)</label>
<input type="number" id="inhaleTime" min="1" max="20" value="4" inputmode="numeric" pattern="[0-9]*">
</div>
<div>
<label for="holdTime">Hold (sec)</label>
<input type="number" id="holdTime" min="0" max="20" value="4" inputmode="numeric" pattern="[0-9]*">
</div>
</div>
<div class="timing-row">
<div>
<label for="exhaleTime">Exhale (sec)</label>
<input type="number" id="exhaleTime" min="1" max="20" value="4" inputmode="numeric" pattern="[0-9]*">
</div>
<div>
<label for="holdTime2">Hold (sec)</label>
<input type="number" id="holdTime2" min="0" max="20" value="4" inputmode="numeric" pattern="[0-9]*">
</div>
</div>
</div>

<div class="setting-group">
<label for="sessionDuration">Session Duration (minutes)</label>
<select id="sessionDuration">
<option value="1">1 minute</option>
<option value="2">2 minutes</option>
<option value="3">3 minutes</option>
<option value="5" selected>5 minutes</option>
<option value="10">10 minutes</option>
<option value="15">15 minutes</option>
<option value="20">20 minutes</option>
<option value="0">Infinite</option>
</select>
</div>

<div class="setting-group">
<label>üíæ Save Current Settings as Preset</label>
<div class="preset-actions">
<input type="text" id="presetName" placeholder="Enter preset name...">
<button class="start-btn" id="savePresetBtn">Save</button>
</div>
<div class="saved-presets" id="savedPresets"></div>
</div>
</div>
</div>

<script>
// Check if running as standalone app
const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;

if (!isStandalone && !localStorage.getItem('installBannerDismissed')) {
document.getElementById('installBanner').style.display = 'block';
}

function showInstallInstructions() {
alert(`üì± To install this app on iPhone/iPad:

1. Tap the Share button (‚ñ° with ‚Üë arrow) at the bottom of Safari
2. Scroll down and tap "Add to Home Screen"
3. Tap "Add" in the top right

Note: This option only appears when viewing the page from a web server (not a local file). 

Options:
‚Ä¢ Email yourself this HTML file and open the attachment in Safari
‚Ä¢ Upload to a free hosting service like GitHub Pages or Netlify
‚Ä¢ Use a local web server app`);
localStorage.setItem('installBannerDismissed', 'true');
document.getElementById('installBanner').style.display = 'none';
}

const breathingCircle = document.getElementById('breathingCircle');
const breathingText = document.getElementById('breathingText');
const phaseTimer = document.getElementById('phaseTimer');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const stopBtn = document.getElementById('stopBtn');
const patternSelect = document.getElementById('patternSelect');
const customTiming = document.getElementById('customTiming');
const progressContainer = document.getElementById('progressContainer');
const progressFill = document.getElementById('progressFill');
const timeRemainingDisplay = document.getElementById('timeRemaining');
const sessionDurationSelect = document.getElementById('sessionDuration');
const presetNameInput = document.getElementById('presetName');
const savePresetBtn = document.getElementById('savePresetBtn');
const savedPresetsContainer = document.getElementById('savedPresets');

const patterns = {
relaxation: { inhale: 4, hold1: 7, exhale: 8, hold2: 0 },
box: { inhale: 4, hold1: 4, exhale: 4, hold2: 4 },
calm: { inhale: 4, hold1: 2, exhale: 6, hold2: 2 },
energize: { inhale: 4, hold1: 0, exhale: 4, hold2: 0 }
};

let isBreathing = false;
let isPaused = false;
let animationFrameId;
let sessionStartTime;
let sessionDuration;
let phaseStartTime;
let currentPhase;
let currentPattern;
let pausedTime = 0;
let totalPausedDuration = 0;
let phaseElapsedBeforePause = 0;

const MIN_SIZE = 120;
const MAX_SIZE = 280;

loadPresets();

patternSelect.addEventListener('change', (e) => {
if (e.target.value === 'custom') {
customTiming.classList.add('active');
} else {
customTiming.classList.remove('active');
}
});

function getCurrentPattern() {
const selectedPattern = patternSelect.value;

if (selectedPattern === 'custom') {
return {
inhale: parseInt(document.getElementById('inhaleTime').value) || 4,
hold1: parseInt(document.getElementById('holdTime').value) || 0,
exhale: parseInt(document.getElementById('exhaleTime').value) || 4,
hold2: parseInt(document.getElementById('holdTime2').value) || 0
};
}

return patterns[selectedPattern];
}

function formatTime(seconds) {
const mins = Math.floor(seconds / 60);
const secs = seconds % 60;
return `${mins}:${secs.toString().padStart(2, '0')}`;
}

function updateCircleSize(progress, isExpanding) {
const size = isExpanding
? MIN_SIZE + (MAX_SIZE - MIN_SIZE) * progress
: MAX_SIZE - (MAX_SIZE - MIN_SIZE) * progress;

breathingCircle.style.width = `${size}px`;
breathingCircle.style.height = `${size}px`;
}

function animate() {
if (!isBreathing || isPaused) return;

const now = Date.now();
const elapsed = (now - phaseStartTime) / 1000;

if (sessionDuration > 0) {
const totalElapsed = (now - sessionStartTime - totalPausedDuration) / 1000;
const remaining = Math.max(0, sessionDuration - Math.floor(totalElapsed));
timeRemainingDisplay.textContent = formatTime(remaining);
progressFill.style.width = `${(totalElapsed / sessionDuration) * 100}%`;

if (totalElapsed >= sessionDuration) {
stopBreathing();
breathingText.textContent = 'Session complete! üéâ';
phaseTimer.textContent = '';
return;
}
} else {
const totalElapsed = Math.floor((now - sessionStartTime - totalPausedDuration) / 1000);
timeRemainingDisplay.textContent = formatTime(totalElapsed);
}

let phaseDuration, phaseProgress;

switch(currentPhase) {
case 'inhale':
phaseDuration = currentPattern.inhale;
phaseProgress = Math.min(elapsed / phaseDuration, 1);
updateCircleSize(phaseProgress, true);
phaseTimer.textContent = Math.ceil(phaseDuration - elapsed);

if (elapsed >= phaseDuration) {
if (currentPattern.hold1 > 0) {
currentPhase = 'hold1';
breathingText.textContent = 'Hold...';
} else {
currentPhase = 'exhale';
breathingText.textContent = 'Breathe out...';
}
phaseStartTime = now;
}
break;

case 'hold1':
phaseDuration = currentPattern.hold1;
phaseTimer.textContent = Math.ceil(phaseDuration - elapsed);

if (elapsed >= phaseDuration) {
currentPhase = 'exhale';
breathingText.textContent = 'Breathe out...';
phaseStartTime = now;
}
break;

case 'exhale':
phaseDuration = currentPattern.exhale;
phaseProgress = Math.min(elapsed / phaseDuration, 1);
updateCircleSize(phaseProgress, false);
phaseTimer.textContent = Math.ceil(phaseDuration - elapsed);

if (elapsed >= phaseDuration) {
if (currentPattern.hold2 > 0) {
currentPhase = 'hold2';
breathingText.textContent = 'Hold...';
} else {
currentPhase = 'inhale';
breathingText.textContent = 'Breathe in...';
}
phaseStartTime = now;
}
break;

case 'hold2':
phaseDuration = currentPattern.hold2;
phaseTimer.textContent = Math.ceil(phaseDuration - elapsed);

if (elapsed >= phaseDuration) {
currentPhase = 'inhale';
breathingText.textContent = 'Breathe in...';
phaseStartTime = now;
}
break;
}

animationFrameId = requestAnimationFrame(animate);
}

function startBreathing() {
isBreathing = true;
isPaused = false;
currentPattern = getCurrentPattern();
const durationMinutes = parseInt(sessionDurationSelect.value);
sessionDuration = durationMinutes * 60;

sessionStartTime = Date.now();
phaseStartTime = Date.now();
currentPhase = 'inhale';
totalPausedDuration = 0;

startBtn.style.display = 'none';
pauseBtn.style.display = 'inline-block';
pauseBtn.textContent = 'Pause';
stopBtn.style.display = 'inline-block';
progressContainer.style.display = 'block';
progressFill.style.width = '0%';

breathingText.textContent = 'Breathe in...';

if (sessionDuration > 0) {
timeRemainingDisplay.textContent = formatTime(sessionDuration);
} else {
timeRemainingDisplay.textContent = '0:00';
}

animate();
}

function pauseBreathing() {
if (isPaused) {
isPaused = false;
pauseBtn.textContent = 'Pause';

const pauseDuration = Date.now() - pausedTime;
totalPausedDuration += pauseDuration;
phaseStartTime = Date.now() - (phaseElapsedBeforePause * 1000);

animate();
} else {
isPaused = true;
pauseBtn.textContent = 'Resume';
pausedTime = Date.now();

phaseElapsedBeforePause = (pausedTime - phaseStartTime) / 1000;

if (animationFrameId) {
cancelAnimationFrame(animationFrameId);
}

breathingText.textContent = 'Paused';
}
}

function stopBreathing() {
isBreathing = false;
isPaused = false;
if (animationFrameId) {
cancelAnimationFrame(animationFrameId);
}

startBtn.style.display = 'inline-block';
pauseBtn.style.display = 'none';
stopBtn.style.display = 'none';
progressContainer.style.display = 'none';
breathingText.textContent = 'Ready to begin';
phaseTimer.textContent = '';
breathingCircle.style.width = `${MIN_SIZE}px`;
breathingCircle.style.height = `${MIN_SIZE}px`;
}

function savePreset() {
const name = presetNameInput.value.trim();
if (!name) {
alert('Please enter a preset name');
return;
}

const preset = {
name: name,
pattern: patternSelect.value,
duration: sessionDurationSelect.value,
customSettings: null
};

if (patternSelect.value === 'custom') {
preset.customSettings = {
inhale: document.getElementById('inhaleTime').value,
hold1: document.getElementById('holdTime').value,
exhale: document.getElementById('exhaleTime').value,
hold2: document.getElementById('holdTime2').value
};
}

let presets = JSON.parse(localStorage.getItem('breathingPresets') || '[]');
presets.push(preset);
localStorage.setItem('breathingPresets', JSON.stringify(presets));

presetNameInput.value = '';
loadPresets();
}

function loadPresets() {
const presets = JSON.parse(localStorage.getItem('breathingPresets') || '[]');

if (presets.length === 0) {
savedPresetsContainer.innerHTML = '';
return;
}

savedPresetsContainer.innerHTML = presets.map((preset, index) => {
let details = '';
if (preset.pattern === 'custom' && preset.customSettings) {
details = `Custom: ${preset.customSettings.inhale}-${preset.customSettings.hold1}-${preset.customSettings.exhale}-${preset.customSettings.hold2}`;
} else {
const p = patterns[preset.pattern];
if (p) {
details = `${preset.pattern.charAt(0).toUpperCase() + preset.pattern.slice(1)}: ${p.inhale}-${p.hold1}-${p.exhale}-${p.hold2}`;
}
}
details += `, ${preset.duration === '0' ? 'Infinite' : preset.duration + ' min'}`;

return `
<div class="preset-item">
<div>
<div class="preset-name">${preset.name}</div>
<div class="preset-details">${details}</div>
</div>
<div class="preset-buttons">
<button class="load-btn" onclick="loadPreset(${index})">Load</button>
<button class="delete-btn" onclick="deletePreset(${index})">Delete</button>
</div>
</div>
`;
}).join('');
}

window.loadPreset = function(index) {
const presets = JSON.parse(localStorage.getItem('breathingPresets') || '[]');
const preset = presets[index];

if (!preset) return;

patternSelect.value = preset.pattern;
sessionDurationSelect.value = preset.duration;

if (preset.pattern === 'custom' && preset.customSettings) {
customTiming.classList.add('active');
document.getElementById('inhaleTime').value = preset.customSettings.inhale;
document.getElementById('holdTime').value = preset.customSettings.hold1;
document.getElementById('exhaleTime').value = preset.customSettings.exhale;
document.getElementById('holdTime2').value = preset.customSettings.hold2;
} else {
customTiming.classList.remove('active');
}

alert(`Loaded preset: ${preset.name}`);
};

window.deletePreset = function(index) {
if (!confirm('Are you sure you want to delete this preset?')) return;

let presets = JSON.parse(localStorage.getItem('breathingPresets') || '[]');
presets.splice(index, 1);
localStorage.setItem('breathingPresets', JSON.stringify(presets));
loadPresets();
};

startBtn.addEventListener('click', startBreathing);
pauseBtn.addEventListener('click', pauseBreathing);
stopBtn.addEventListener('click', stopBreathing);
savePresetBtn.addEventListener('click', savePreset);
</script>
</body>
</html>
